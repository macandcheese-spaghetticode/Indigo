property eGrepBitcoinPrice : "priceValue___11gHJ\">\\$\\d{2},\\d{3}.\\d{2}"
property eGrepLitecoinPrice : "priceValue___11gHJ\">\\$\\d{3}.\\d{2}"
property eGrepDogecoinPrice : "priceValue___11gHJ\">\\$\\d{1}.\\d{5}"
property currentBitcoinPrice : missing value
property currentLitecoinPrice : missing value
property currentDogecoinPrice : missing value
on idle
	
	getPrices()
	--Opens the compiled Excel workbook, negates user input, finds the next available--
	--cell to input data, and fills the fields with Year, Month, Day, Time, and Price--
	set {year:y, month:m, day:d} to (current date)
	tell application "Microsoft Excel"
		open "/Users/clusterflux/Desktop/人CRYPTO人_excel.xlsx"
		set display alerts to false
		activate object sheet "ㅇㅅㅇBITCOINㅇㅅㅇ"
		first row index of (get end (last cell of column 9) direction toward the top)
		set LastRowBitcoin to first row index of (get end (last cell of column 9) direction toward the top)
		--write date and time for each market reading to excel file
		set value of cell ("I" & LastRowBitcoin + 1) to y
		set value of cell ("J" & LastRowBitcoin + 1) to (date of (current date))
		set value of cell ("K" & LastRowBitcoin + 1) to d
		set value of cell ("L" & LastRowBitcoin + 1) to (time string of (current date))
		set value of cell ("M" & LastRowBitcoin + 1) to currentBitcoinPrice
		activate object sheet "ㅇㅅㅇLITECOINㅇㅅㅇ"
		first row index of (get end (last cell of column 9) direction toward the top)
		set LastRowLitecoin to first row index of (get end (last cell of column 9) direction toward the top)
		set value of cell ("I" & LastRowLitecoin + 1) to y
		set value of cell ("J" & LastRowLitecoin + 1) to (date of (current date))
		set value of cell ("K" & LastRowLitecoin + 1) to d
		set value of cell ("L" & LastRowLitecoin + 1) to (time string of (current date))
		set value of cell ("M" & LastRowLitecoin + 1) to currentLitecoinPrice
		activate object sheet "ㅇㅅㅇDOGECOINㅇㅅㅇ"
		first row index of (get end (last cell of column 9) direction toward the top)
		set LastRowDogecoin to first row index of (get end (last cell of column 9) direction toward the top)
		set value of cell ("I" & LastRowDogecoin + 1) to y
		set value of cell ("J" & LastRowDogecoin + 1) to (date of (current date))
		set value of cell ("K" & LastRowDogecoin + 1) to d
		set value of cell ("L" & LastRowDogecoin + 1) to (time string of (current date))
		set value of cell ("M" & LastRowDogecoin + 1) to currentDogecoinPrice
		set workbookName to ("人CRYPTO人_excel.xlsx") as string
		set destinationPath to (path to desktop as text) & workbookName
		save active workbook in destinationPath
		
		--close every workbook saving no--
		--tell application "Microsoft Excel"--
		--quit--
	end tell
	
	return 10 -- In Seconds, How Often To Run Code In This Idle Handler
end idle
on getPrices()
	set currentBitcoinPrice to do shell script ¬
		"curl --no-keepalive 'https://coinmarketcap.com/currencies/bitcoin/markets/' " & ¬
		"| grep -Eo " & quoted form of eGrepBitcoinPrice & " | cut -c 21-"
	set currentLitecoinPrice to do shell script ¬
		"curl --no-keepalive 'https://coinmarketcap.com/currencies/litecoin/' " & ¬
		"| grep -Eo " & quoted form of eGrepLitecoinPrice & " | cut -c 21-"
	set currentDogecoinPrice to do shell script ¬
		"curl --no-keepalive 'https://coinmarketcap.com/currencies/dogecoin/' " & ¬
		"| grep -Eo " & quoted form of eGrepDogecoinPrice & " | cut -c 21-"
end getPrices
